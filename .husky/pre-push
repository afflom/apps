echo "Running essential checks for push..."
npm run typecheck && npm run lint && npm run format:check && npx vitest run src/simple.test.ts src/utils/dom.test.ts

echo ""
echo "Verifying dev deployment before pushing to remote..."

# Always validate the dev deployment before any push
echo "Building app for dev environment..."
npm run build

if [ $? -ne 0 ]; then
  echo "ERROR: Build failed. Fix build issues before pushing."
  exit 1
fi

echo "Build successful. Attempting to deploy to dev environment..."

# Try the dev deployment script
export GH_WORKFLOW_DISPATCH=true
npm run deploy:dev -- --no-interactive

# Check if deployment was successful
if [ $? -ne 0 ]; then
  echo "ERROR: Dev deployment failed. Fix deployment issues before pushing."
  exit 1
fi

echo "Dev deployment successfully verified. Proceeding with push..."
